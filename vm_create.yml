---
- hosts: localhost
  gather_facts: false

  vars:
    vc_host: '10.0.0.12'
    vc_user: 'administrator@vsphere.local'
    vc_pass: !vault |
          $ANSIBLE_VAULT;1.1;AES256
          64636630663035653165336562626564303231316563326664383438656338393233663935383162
          3234333164376463636165346437646563306631656363620a366364363762636332303638633034
          32383663336233623637326430303537343839623332646132376364646561366332396232653866
          3339393833646230370a363663656536653861353239393264616661326634353536393939633464
          6462
    local_pass: !vault |
          $ANSIBLE_VAULT;1.1;AES256
          32653630353338633266656139393961303637333665623830346539393661333035363863636538
          6135356366663531333636326635646361663231303137310a393334353034356131363561386564
          63303165303932373531353366613066313935393161343134383764306465323164323434656163
          3734373434326433660a626465616466353933666133383836653835313235396537353538663162
          6663
    # mod_name: Name to assign to VM. Set by Tower survey
    # mod_ip: IP to assign to VM. Set by Tower survey
    # mod_os: Template to clone from. Set by Tower survey

  tasks:
  - name: clone guest
    vmware_guest:
      hostname: "{{ vc_host }}"
      username: "{{ vc_user }}"
      password: "{{ vc_pass }}"
      validate_certs: no
      datacenter: MOD
      cluster: NUC
      name: "{{ mod_name }}"
      template: "{{mod_os}}"
      networks:
      - name: Servers
        ip: "{{ mod_ip }}"
        netmask: 255.255.255.0
        gateway: 10.0.0.1
      disk:
      - size_gb: 40
        datastore: Local01
      customization:
        name: "{{ mod_name}}.mod.local"
        domain: mod.local
        password:
      wait_for_ip_address: yes
